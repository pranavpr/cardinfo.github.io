<div id="recent-comments"></div>
<script>
  function classAdd(el, cls) {
    el.classList.add('commento-' + cls);
  }

  function create(el) {
    return document.createElement(el);
  }

  function attrSet(node, a, value) {
    node.setAttribute(a, value);
  }

  function getColor(name) {
    var colors = [
      '#396ab1',
      '#da7c30',
      '#3e9651',
      '#cc2529',
      '#922428',
      '#6b4c9a',
      '#535154'
    ];

    var total = 0;
    for (var i = 0; i < name.length; i++) {
      total += name.charCodeAt(i);
    }
    var color = colors[total % colors.length];

    return color;
  }
  var commentsHTML = '';
  var latestComments;
  var latestCommenters;
  var domain = 'cardinfo.in';
  var cdn = 'https://api.cardinfo.in';
  $.ajax({
    type: 'GET',
    url: cdn + '/api/comment/summary',
    data: { domain: domain, count: 10 },
    cache: false,
    dataType: 'json',
    success: function(data) {
      latestComments = data.comments;
      latestCommenters = data.commenters;
      latestComments.forEach(function(comment) {
        var avatar;
        var color = getColor(
          comment.commenterHex +
            '-' +
            latestCommenters[comment.commenterHex].name
        );
        if (latestCommenters[comment.commenterHex].photo === 'undefined') {
          avatar = create('div');
          avatar.style['background'] = color;

          if (comment.commenterHex === 'anonymous') {
            avatar.innerHTML = '?';
            avatar.style['font-weight'] = 'bold';
          } else {
            avatar.innerHTML = latestCommenters[
              comment.commenterHex
            ].name[0].toUpperCase();
          }

          classAdd(avatar, 'avatar');
        } else {
          avatar = create('img');
          attrSet(
            avatar,
            'src',
            cdn + '/api/commenter/photo?commenterHex=' + comment.commenterHex
          );
          classAdd(avatar, 'avatar-img');
        }
        commentsHTML +=
          '<div class="row p-1"><div class="col-2 col-md-4 col-lg-3 avatar">' +
          avatar.outerHTML +
          '</div><div class="col-10 col-md-8 col-lg-9 p-0"> ' +
          latestCommenters[comment.commenterHex].name +
          ' on <a href="' +
          comment.url +
          '#commento-' +
          comment.commentHex +
          '">' +
          comment.title +
          '</a></div></div>';
      });
      var finalCommentsHTML =
        '<h4 class="font-weight-bold spanborder"><span>Recent Comments</span></h4><div class="comments text-muted">' +
        commentsHTML +
        '</div>';
      $('#recent-comments').html(finalCommentsHTML);
    }
  });
</script>
